.. _jp_process_submitting_patches:

パッチの投稿: カーネルにコードを入れるための必須ガイド
======================================================

.. note::

   このドキュメントは :ref:`Documentation/process/submitting-patches.rst <submittingpatches>` の日本語訳です。

   免責事項: :ref:`translations_ja_JP_disclaimer`

.. warning::

   **UNDER CONSTRUCTION!!**

   この文書は翻訳更新の作業中です。最新の内容は原文を参照してください。

Linux カーネルへ変更を投稿したい個人や企業にとって、もし「仕組み」に
慣れていなければ、そのプロセスは時に気後れするものでしょう。
このテキストは、あなたの変更が受け入れられる可能性を大きく高めるための
提案を集めたものです。

この文書には、比較的簡潔な形式で多数の提案が含まれています。
カーネル開発プロセスの仕組みに関する詳細は
Documentation/process/development-process.rst を参照してください。
また、コードを投稿する前に確認すべき項目の一覧として
Documentation/process/submit-checklist.rst を読んでください。
デバイスツリーバインディングのパッチについては、
Documentation/devicetree/bindings/submitting-patches.rst を読んでください。

この文書は、パッチ作成に ``git`` を使う前提で書かれています。
もし ``git`` に不慣れであれば、使い方を学ぶことを強く勧めます。
それにより、カーネル開発者として、また一般的にも、あなたの作業は
ずっと楽になるでしょう。

いくつかのサブシステムやメンテナツリーには、各々のワークフローや
期待事項に関する追加情報があります。次を参照してください:
:ref:`Documentation/process/maintainer-handbooks.rst <maintainer_handbooks_main>`.

現在のソースツリーを入手する
----------------------------

もし手元に最新のカーネルソースのリポジトリがなければ、``git`` を使って取得して
ください。まずは mainline のリポジトリから始めるのがよいでしょう。これは
次のようにして取得できます::

  git clone git://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git

ただし、直接 mainline のツリーを対象に作業すればよいとは限らないことに注意
してください。多くのサブシステムのメンテナはそれぞれ独自のツリーを運用しており、
そのツリーに対して作成されたパッチを見たいと考えています。該当サブシステムの
ツリーは MAINTAINERS ファイル内の **T:** エントリを参照して見つけてください。
そこに掲載されていない場合は、メンテナに問い合わせてください。

変更内容を記述する
------------------

まず問題点を述べてください。あなたのパッチが 1 行のバグ修正であっても、5000
行の新機能であっても、それを行う動機となった根本的な問題が必ずあるはずです。
レビューアが、修正すべき問題がたしかに存在し、冒頭の段落の続きを読むべきだと
納得できるように書いてください。

次にユーザーから見える影響を記述してください。クラッシュやロックアップは分かり
やすいですが、すべてのバグがそこまで露骨とは限りません。たとえコードレビュー中に
見つかった問題であっても、ユーザーにどのような影響があり得るかを記述してください。
Linux の多くの環境は、上流から特定のパッチだけを取り込む二次的な安定版ツリーや、
ベンダー／製品固有のツリーのカーネルで動いています。したがって、変更を適切に
下流へ流す際に助けになる情報（発生条件、dmesg の抜粋、クラッシュ内容、性能劣化、
レイテンシのスパイク、ロックアップ等）があれば記載してください。

次に最適化とトレードオフを定量的に示してください。パフォーマンス、メモリ消費量、
スタックフットプリント、バイナリサイズの改善を主張する場合は、それを裏付ける
数値を記載してください。また、目に見えないコストについても記述してください。
最適化には多くの場合なんらかの代償、すなわち、CPU・メモリ・可読性の間での
トレードオフが伴います。
ヒューリスティクスの場合は、異なるワークロード間でのトレードオフになります。
レビューアがコストとメリットを比較検討できるよう、最適化に伴って想定される
デメリットも記述してください。

問題点の明確化が済んだら、実際にどのような対策を講じているかを技術的に詳しく
説明してください。コードが意図したとおりに動作していることをレビューアが確認
できるよう、変更内容を平易な言葉で書き下すことが重要です。

パッチの説明が Linux のソースコード管理システム ``git`` の「コミットログ」
としてそのまま取り込める形で書かれていれば、メンテナは助かります。
詳細は原文の該当節 ("The canonical patch format") を参照してください。

.. TODO: Convert to file-local cross-reference when the destination is
   translated.

1 つのパッチでは 1 つの問題だけを解決してください。記述が長くなり始めたら、
それはパッチを分割すべきサインです。
詳細は原文の該当節 ("Separate your changes") を参照してください。

.. TODO: Convert to file-local cross-reference when the destination is
   translated.
